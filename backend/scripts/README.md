# ุณูุฑูุจุชุงุช ุงููุธุงู | System Scripts

## ูุธุฑุฉ ุนุงูุฉ | Overview

ูุฐุง ุงููุฌูุฏ ูุญุชูู ุนูู ุณูุฑูุจุชุงุช ูุณุงุนุฏุฉ ูุฅุฏุงุฑุฉ ูุงุฎุชุจุงุฑ ุงููุธุงู.

This folder contains utility scripts for managing and testing the system.

---

## ุงูุณูุฑูุจุชุงุช ุงููุชุงุญุฉ | Available Scripts

### 1. ุงุฎุชุจุงุฑ ุชุทุจูู ุงูุตูุงุญูุงุช โจ ุฌุฏูุฏ
### Test Permission Enforcement โจ NEW

```bash
node scripts/testPermissionEnforcement.js
```

**ุงููุธููุฉ | Function:**
- ูุนุฑุถ ุญุงูุฉ ุงูุตูุงุญูุงุช ููู ูุฏูุฑ
- ููุถุญ ุฃู routes ุณุชุนูู ูุฃููุง ุณุชูููุน
- ูุฎุชุจุฑ ุงููููุฏ ุงูุฅูููููุฉ ูุงููุณููุฉ
- ูุคูุฏ ุฃู middleware ุงูุตูุงุญูุงุช ูุทุจู

**ุงููุชุงุฆุฌ ุงููุชููุนุฉ | Expected Output:**
```
โ Regional Admin: ูุฑูู (@krym)
   Assigned Region: ุนุจุฏ ุงูุฑุญูู ุดููุฑ

   View Members (canViewMembers): โ ALLOWED
   Routes affected:
      GET /api/admin/users โ โ Will work

   Manage Members (canManageMembers): โ BLOCKED
   Routes affected:
      POST /api/admin/users โ โ Will return 403
```

**ูุชู ุชุณุชุฎุฏูู | When to use:**
- ููุชุญูู ูู ุฃู ุงูุตูุงุญูุงุช ูุทุจูุฉ ุนูู ุงูู routes
- ูุฑุคูุฉ ุชุฃุซูุฑ ุชูุนูู/ุชุนุทูู ุตูุงุญูุฉ
- ูุชูุซูู ุญุงูุฉ ุงูุตูุงุญูุงุช ุงูุญุงููุฉ

---

### 2. ุงุฎุชุจุงุฑ ูุนูู ูุญุธุฑ ุงูุตูุงุญูุงุช โจ ุฌุฏูุฏ
### Actual Permission Blocking Test โจ NEW

```bash
node scripts/testActualPermissionBlocking.js
```

**ุงููุธููุฉ | Function:**
- ูุณุฌู ุฏุฎูู ููุฏูุฑ ููุทูุฉ
- ููุนูู ุตูุงุญูุฉ ููุญุงูู ุงููุตูู โ ูุฌุจ ุฃู ููุฌุญ โ
- ูุนุทู ุงูุตูุงุญูุฉ ููุญุงูู ูุฑุฉ ุฃุฎุฑู โ ูุฌุจ ุฃู ููููุน โ
- ูุฎุชุจุฑ canViewMembers ู canManageMembers
- ูุซุจุช ุฃู ุงูุตูุงุญูุงุช ุชุนูู ูุนููุงู ุนูู API

**ุงููุชุงุฆุฌ ุงููุชููุนุฉ | Expected Output:**
```
๐งช Test 1: canViewMembers = ENABLED
โ GET /api/admin/users โ SUCCESS (Status: 200)

๐งช Test 2: canViewMembers = DISABLED
โ GET /api/admin/users โ CORRECTLY BLOCKED
   Status: 403 Forbidden
   Message: Access denied. You don't have permission: canViewMembers
   ๐ SUCCESS: Permission enforcement is working!
```

**ูุชู ุชุณุชุฎุฏูู | When to use:**
- ููุชุญูู ูู ุฃู ุงูุตูุงุญูุงุช ุชููุน ูุนููุงู
- ูุงุฎุชุจุงุฑ ุงูู API ุจุนุฏ ุชุนุฏููุงุช ุนูู ุงูู routes
- ูุฅุซุจุงุช ุฃู middleware ูุนูู ุจุดูู ุตุญูุญ

**โ๏ธ ููุงุญุธุฉ:** ุงูุณูุฑูุจุช ูุนููู ูููุฉ ูุฑูุฑ ูุคูุชุฉ "test1234" ููุณุชุนูุฏ ุงูุตูุงุญูุงุช ุจุนุฏ ุงูุงุฎุชุจุงุฑ.

---

### 3. ุงุฎุชุจุงุฑ ุตูุงุญูุงุช ูุฏูุฑู ุงูููุงุทู
### Test Regional Admin Permissions

```bash
node scripts/testRegionalAdminPermissions.js
```

**ุงููุธููุฉ | Function:**
- ูุนุฑุถ ุฌููุน ูุฏูุฑู ุงูููุงุทู ูู ุงููุธุงู
- ูุชุญูู ูู ุชุนููู ุงูููุงุทู ููู ูุฏูุฑ
- ูุนุฑุถ ุงูุตูุงุญูุงุช ุงูููุนูุฉ ูุงููุนุทูุฉ
- ูุนุฑุถ ุงูุจูุงูุงุช ุงููุชุงุญุฉ ููู ูุฏูุฑ
- ูุนุฑุถ ุงููููุฏ ุนูู ุงููุตูู

**ูุชู ุชุณุชุฎุฏูู | When to use:**
- ููุชุญูู ูู ุฃู ูุฏูุฑู ุงูููุงุทู ูุฏููู ุงูุตูุงุญูุงุช ุงูุตุญูุญุฉ
- ูุงุณุชูุดุงู ูุดุงูู ุงููุตูู ุฅูู ุงูุจูุงูุงุช
- ููุชุญูู ูู ุฃู ุงููููุฏ ุชุนูู ุจุดูู ุตุญูุญ

---

### 2. ุงุฎุชุจุงุฑ ุตูุงุญูุงุช ูุฏูุฑู ุงูุฃูุณุงู
### Test Category Admin Permissions

```bash
node scripts/testCategoryAdminPermissions.js
```

**ุงููุธููุฉ | Function:**
- ูุนุฑุถ ุฌููุน ูุฏูุฑู ุงูุฃูุณุงู ูู ุงููุธุงู
- ูุชุญูู ูู ุชุนููู ุงูุฃูุณุงู ููู ูุฏูุฑ
- ูุนุฑุถ ุงูุตูุงุญูุงุช ุงูููุนูุฉ ูุงููุนุทูุฉ
- ูุนุฑุถ ุงูููุชุฌุงุช ูู ุงูุฃูุณุงู ุงููุฎุตุตุฉ
- ูุฏุนู ูุฏูุฑู ุงูุฃูุณุงู ุงููุชุนุฏุฏุฉ

**ูุชู ุชุณุชุฎุฏูู | When to use:**
- ููุชุญูู ูู ุฃู ูุฏูุฑู ุงูุฃูุณุงู ูุฏููู ุงูุตูุงุญูุงุช ุงูุตุญูุญุฉ
- ููุชุญูู ูู ุฃู ูุฏูุฑ ุงููุณู ููููู ุฅุฏุงุฑุฉ ุฃูุซุฑ ูู ูุณู
- ูุงุณุชูุดุงู ูุดุงูู ุงููุตูู ุฅูู ุงูููุชุฌุงุช

---

### 3. ุฅุนุฏุงุฏ ุตูุงุญูุงุช ุชุฌุฑูุจูุฉ
### Setup Test Permissions

```bash
node scripts/setupTestPermissions.js
```

**ุงููุธููุฉ | Function:**
- ูุนูู ููุงุทู ุชููุงุฆูุงู ููุฏูุฑู ุงูููุงุทู ุงูุฐูู ููุณ ูุฏููู ููุทูุฉ
- ูุนูู ุฃูุณุงู ุชููุงุฆูุงู ููุฏูุฑู ุงูุฃูุณุงู:
  - ุงููุฏูุฑ ุงูุฃูู: ูุณู ูุงุญุฏ
  - ุงููุฏูุฑ ุงูุซุงูู: ูุณููู
  - ุจููุฉ ุงููุฏูุฑูู: ุฌููุน ุงูุฃูุณุงู
- ููุนูู ุฌููุน ุงูุตูุงุญูุงุช ููุงุฎุชุจุงุฑ

**ูุชู ุชุณุชุฎุฏูู | When to use:**
- ุนูุฏ ุฅุนุฏุงุฏ ุจูุฆุฉ ุงูุงุฎุชุจุงุฑ
- ูุฅุนุทุงุก ุตูุงุญูุงุช ุณุฑูุนุฉ ูุฌููุน ุงููุฏูุฑูู
- ุจุนุฏ ุฅุถุงูุฉ ูุฏูุฑูู ุฌุฏุฏ

**โ๏ธ ุชุญุฐูุฑ:** ูุฐุง ุงูุณูุฑูุจุช ููุงุฎุชุจุงุฑ ููุท! ูุง ุชุณุชุฎุฏูู ูู ุจูุฆุฉ ุงูุฅูุชุงุฌ.

---

### 4. ุฅุตูุงุญ ุฃุณูุงุก ุงููุณุชุฎุฏููู ุงูุนุฑุจูุฉ
### Fix Arabic Usernames

```bash
node scripts/fixArabicUsernames.js
```

**ุงููุธููุฉ | Function:**
- ูุจุญุซ ุนู ุฌููุน ุฃุณูุงุก ุงููุณุชุฎุฏููู ุงูุชู ุชุญุชูู ุนูู ุฃุญุฑู ุนุฑุจูุฉ
- ูุญูููุง ุฅูู ุฃุญุฑู ุฅูุฌููุฒูุฉ
- ูุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุชูุฑุงุฑ ูู ุงูุฃุณูุงุก

**ูุชู ุชุณุชุฎุฏูู | When to use:**
- ุจุนุฏ ุชุทุจูู ูููุฏ ุฃุณูุงุก ุงููุณุชุฎุฏููู ุงูุฅูุฌููุฒูุฉ ููุท
- ูุชูุธูู ุงูุจูุงูุงุช ุงููุฏููุฉ

---

### 5. ุชุญุฏูุซ ุฃููุงุฏ ุงูุฃุนุถุงุก โจ ุฌุฏูุฏ
### Update Member Codes โจ NEW

```bash
# ุนุฑุถ ุงูุชุบููุฑุงุช ุงูููุชุฑุญุฉ (ูุง ูุทุจู ุงูุชุบููุฑุงุช)
node scripts/updateMemberCodes.js

# ุชุทุจูู ุงูุชุบููุฑุงุช
node scripts/updateMemberCodes.js --confirm
```

**ุงููุธููุฉ | Function:**
- ูุญุฏุซ ุฃููุงุฏ ุงูุฃุนุถุงุก ุงูุญุงููุฉ ูุงุณุชุฎุฏุงู ุงูุฃุญุฑู ุงูุฅูุฌููุฒูุฉ ุงูุตุญูุญุฉ ููุฏูู
- ูุซุงู: ููุณุทูู ูู F ุฅูู P (Palestine)
- ูุชุญูู ูู ุนุฏู ูุฌูุฏ ุชุนุงุฑุถ ูู ุงูุฃููุงุฏ
- ูุนุฑุถ ุงูุชุบููุฑุงุช ูุจู ุชุทุจูููุง

**ุงููุชุงุฆุฌ ุงููุชููุนุฉ | Expected Output:**
```
๐ ุงูุชุบููุฑุงุช ุงูููุชุฑุญุฉ:

1. ูุฑูู (@krym)
   ุงูุฏููุฉ: ููุณุทูู | ุงููุฏููุฉ: ุบุฒุฉ
   FG518471 โ PG518471
   ุงูุณุจุจ: ุชุญุฏูุซ ุญุฑู ุงูุฏููุฉ

โ ุชู ุงูุชุญุฏูุซ ุจูุฌุงุญ!
   ุนุฏุฏ ุงูุฃููุงุฏ ุงููุญุฏุซุฉ: 2
```

**ูุชู ุชุณุชุฎุฏูู | When to use:**
- ุจุนุฏ ุชุญุฏูุซ ููุทู ุชูููุฏ ุฃููุงุฏ ุงูุฃุนุถุงุก
- ูุชุตุญูุญ ุงูุฃููุงุฏ ุงูุญุงููุฉ ูุชุทุงุจู ุงููุนุงููุฑ ุงูุฌุฏูุฏุฉ
- ุนูุฏ ุงูุชุดุงู ุฃููุงุฏ ุจุฃุญุฑู ุฏูู ุบูุฑ ุตุญูุญุฉ

**โ๏ธ ููู:** ุงูุณูุฑูุจุช ูุนุฑุถ ุงูุชุบููุฑุงุช ุฃููุงูุ ุซู ูุทูุจ ุชุฃููุฏุงู ูุจู ุงูุชุทุจูู

---

## ๐ ุฏููู ุงูุงุฎุชุจุงุฑ ุงูุณุฑูุน | Quick Testing Guide

**ููุชุญูู ูู ุฃู ุงูุตูุงุญูุงุช ุชุนูู:**

```bash
# 1. ุนุฑุถ ุญุงูุฉ ุงูุตูุงุญูุงุช
node scripts/testPermissionEnforcement.js

# 2. ุงุฎุชุจุงุฑ ูุนูู ุนูู API
node scripts/testActualPermissionBlocking.js
```

**ุฅุฐุง ูุฌุญ ุงูุงุซูุงู โ ุงูุตูุงุญูุงุช ุชุนูู ุจุดูู ูุงูู! โ**

**ููุงุฎุชุจุงุฑ ุงููุฏูู:**
1. ุงุฐูุจ ุฅูู ุตูุญุฉ ุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช
2. ุนุทูู ุตูุงุญูุฉ ููุฏูุฑ
3. ุณุฌู ุฏุฎูู ููุฐุง ุงููุฏูุฑ
4. ุญุงูู ุชูููุฐ ุงูุนูููุฉ โ **ูุฌุจ ุฃู ุชูููุน** โ
5. ุฃุนุฏ ุชูุนูู ุงูุตูุงุญูุฉ
6. ุญุงูู ูุฑุฉ ุฃุฎุฑู โ **ูุฌุจ ุฃู ุชุนูู** โ

---

## ุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู | Usage Examples

### ูุซุงู 1: ุงูุชุญูู ูู ุตูุงุญูุงุช ุฌููุน ุงููุฏูุฑูู

```bash
# Regional admins
node scripts/testRegionalAdminPermissions.js

# Category admins
node scripts/testCategoryAdminPermissions.js
```

### ูุซุงู 2: ุฅุนุฏุงุฏ ุจูุฆุฉ ุงุฎุชุจุงุฑ ุฌุฏูุฏุฉ

```bash
# 1. Setup permissions
node scripts/setupTestPermissions.js

# 2. Verify setup
node scripts/testRegionalAdminPermissions.js
node scripts/testCategoryAdminPermissions.js
```

### ูุซุงู 3: ุฅุตูุงุญ ูุดููุฉ ูู ุงูุตูุงุญูุงุช

```bash
# 1. Check current state
node scripts/testRegionalAdminPermissions.js

# 2. Fix by re-running setup
node scripts/setupTestPermissions.js

# 3. Verify fix
node scripts/testRegionalAdminPermissions.js
```

---

## ุงููุชุงุฆุฌ ุงููุชููุนุฉ | Expected Results

### โ ูุชุงุฆุฌ ุตุญูุญุฉ | Correct Results

**For Regional Admins:**
```
โ Region: ุฌููู
โ View Members: ENABLED
โ Manage Members: ENABLED
โ CAN view members in ุฌููู
โ CANNOT access data from other regions
```

**For Category Admins:**
```
โ Assigned Categories (2):
   1. ุงูุจูุงุฑุงุช
   2. ุงูุฃุบุฐูุฉ
โ View Products: ENABLED
โ Manage Products: ENABLED
โ CAN view products in assigned categories
โ CANNOT access products from other categories
```

### โ ูุชุงุฆุฌ ุชุดูุฑ ููุดููุฉ | Results Indicating Problems

```
โ FAIL: No region assigned!
โ FAIL: No categories assigned!
โ๏ธ WARNING: This admin has NO permissions enabled!
```

**ุงูุญู | Solution:**
1. ุงุณุชุฎุฏู ุณูุฑูุจุช `setupTestPermissions.js`
2. ุฃู ูู ุจุงูุชุนููู ูุฏููุงู ูู ููุญุฉ ุงูุชุญูู

---

## ููุงุญุธุงุช ูููุฉ | Important Notes

1. **ูุงุนุฏุฉ ุงูุจูุงูุงุช**: ุฌููุน ุงูุณูุฑูุจุชุงุช ุชุณุชุฎุฏู `MONGODB_URI` ูู ููู `.env`
2. **ุงูุฃูุงู**: ุณูุฑูุจุช `setupTestPermissions.js` ููุงุฎุชุจุงุฑ ููุท
3. **ุงูุฃุฏุงุก**: ุงูุณูุฑูุจุชุงุช ุชุณุชุฎุฏู queries ุจุณูุทุฉ ูุณุฑูุนุฉ
4. **ุงูุชูุงูููุฉ**: ุชุนูู ูุน ุฌููุน ุฅุตุฏุงุฑุงุช MongoDB

---

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก | Troubleshooting

### ุงููุดููุฉ: "MongoDB connection error"
**ุงูุญู:**
- ุชุญูู ูู ููู `.env`
- ุชุฃูุฏ ูู ุฃู MongoDB ูุนูู
- ุชุญูู ูู `MONGODB_URI`

### ุงููุดููุฉ: "No admins found"
**ุงูุญู:**
- ุฃูุดุฆ ูุฏูุฑูู ูู ููุญุฉ ุงูุชุญูู ุฃููุงู
- ุฃู ุชุญูู ูู ุงูุฏูุฑ (role) ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงููุดููุฉ: ุงูุณูุฑูุจุช ูุนูู ููู ูุง ุดูุก ูุชุบูุฑ
**ุงูุญู:**
- ุชุญูู ูู ุตูุงุญูุงุช ุงููุชุงุจุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุฑุงุฌุน ุฑุณุงุฆู console.log ููุฃุฎุทุงุก
- ุชุญูู ูู ุฃู ุงูุชุบููุฑุงุช ูุญููุธุฉ ุจุงููุนู

---

## ูููุทูุฑูู | For Developers

### ุฅุถุงูุฉ ุณูุฑูุจุช ุฌุฏูุฏ

1. ุฃูุดุฆ ููู ูู `scripts/`
2. ุฃุถู require ููู models ุงููุทููุจุฉ
3. ุฃุถู ุงูุงุชุตุงู ุจู MongoDB
4. ุงูุชุจ ุงูููุทู ุงูุฎุงุต ุจู
5. ุงุณุชุฎุฏู `process.exit(0)` ูู ุงูููุงูุฉ
6. ูุซูู ุงูุณูุฑูุจุช ููุง ูู README

### ูุซุงู ุณูุฑูุจุช ุจุณูุท

```javascript
const mongoose = require('mongoose');
require('dotenv').config();

mongoose.connect(process.env.MONGODB_URI)
  .then(async () => {
    console.log('Connected!');

    // Your logic here

    process.exit(0);
  })
  .catch(err => {
    console.error('Error:', err);
    process.exit(1);
  });
```

---

## ุงูููุงุฑุฏ | Resources

- [ุฏููู ุงูุตูุงุญูุงุช ุงููุงูู](../PERMISSIONS_GUIDE.md)
- [ุชูุซูู ุงูููุงุฐุฌ](../models/)
- [ุชูุซูู Middleware](../middleware/)

---

## ุงูุฏุนู | Support

ูููุณุงุนุฏุฉ ุฃู ุงูุฃุณุฆูุฉ:
- ุฑุงุฌุน ุฏููู PERMISSIONS_GUIDE.md
- ุงูุชุญ issue ูู ุงููุดุฑูุน
- ุงุชุตู ุจูุฑูู ุงูุชุทููุฑ
