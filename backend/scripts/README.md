# ูุธุงู ููุงุท ุงูุชุฑุญูุจ (Welcome Bonus System)

## ูุธุฑุฉ ุนุงูุฉ

ุนูุฏ ุชุณุฌูู ุนุถู ุฌุฏูุฏุ ูุญุตู ุนูู ูุฑุตุฉ ุงูุญุตูู ุนูู **10 ููุงุท ูุฏูุฉ** ุฅุฐุง ูุงู ุจุฃูู ุนูููุฉ ุดุฑุงุก ุฎูุงู **30 ููู** ูู ุชุงุฑูุฎ ุงูุชุณุฌูู.

## ุขููุฉ ุงูุนูู

### 1. ุนูุฏ ุงูุชุณุฌูู
- ูุชู ุชุนููู `firstOrderBonus.expiresAt` ุฅูู 30 ููู ูู ุชุงุฑูุฎ ุงูุชุณุฌูู
- `firstOrderBonus.received = false`
- `firstOrderBonus.points = 10`

### 2. ุนูุฏ ุฃูู ุนูููุฉ ุดุฑุงุก
- โ **ุฅุฐุง ูุงู ุงูุดุฑุงุก ุฎูุงู 30 ููู**: ูุญุตู ุนูู 10 ููุงุท ุชุฑุญูุจูุฉ
- โ **ุฅุฐุง ูุงู ุงูุดุฑุงุก ุจุนุฏ 30 ููู**: ูุง ูุญุตู ุนูู ุงูููุงุท

### 3. ุงูููุงุท ูุงูุฃุฑุจุงุญ
- ุงูููุงุท ุงูุชุฑุญูุจูุฉ **ุชุฏุฎู** ูู ุญุณุงุจ ุงูุฃุฑุจุงุญ ุฅุฐุง ุชู ุงูุญุตูู ุนูููุง
- ุงูููุงุท **ูุง ุชูุนุทู** ุฅุฐุง ุงูุชูุช ุงููุฏุฉ (30 ููู)

## ุชูุธูู ุงูููุงุท ุงูููุชููุฉ

### ุชุดุบูู ุงูู Script ูุฏููุงู

```bash
cd backend/scripts
node cleanupExpiredBonuses.js
```

### ุฌุฏููุฉ ุชููุงุฆูุฉ (Cron Job)

ูุชุดุบูู ุงูู script ุชููุงุฆูุงู ูู ูููุ ุฃุถู ุงูููุฏ ุงูุชุงูู ูู `backend/server.js`:

```javascript
const cron = require('node-cron');
const cleanupExpiredBonuses = require('./scripts/cleanupExpiredBonuses');

// ุชุดุบูู ุงูุชูุธูู ูู ููู ูู ุงูุณุงุนุฉ 3 ุตุจุงุญุงู
cron.schedule('0 3 * * *', async () => {
  console.log('๐งน Running expired bonuses cleanup...');
  await cleanupExpiredBonuses();
});
```

**ุชุซุจูุช node-cron:**
```bash
npm install node-cron
```

## ููุงุญุธุงุช ูููุฉ

1. ุงูู script **ุงุฎุชูุงุฑู** - ุงููุธุงู ูุนูู ุจุฏููู
2. ุงูู logic ุงูุฃุณุงุณู ูู `orderController.js` ูุชุญูู ูู `expiresAt` ูุจู ุฅุถุงูุฉ ุงูููุงุท
3. ุงูู script ููุท ููุชูุถูุญ ูุงูุชูุธูู (cleanup)
4. ุงูููุงุท ุงูุชุฑุญูุจูุฉ ุชูุนุทู **ูุฑุฉ ูุงุญุฏุฉ ููุท** ููู ุนุถู

## ุงูุชุญูู ูู ุงููุธุงู

ููุชุญูู ูู ุฃู ุงููุธุงู ูุนูู ุจุดูู ุตุญูุญ:

```javascript
// ูู MongoDB Compass ุฃู mongo shell
db.users.find({
  role: 'member',
  'firstOrderBonus.received': false,
  'firstOrderBonus.expiresAt': { $exists: true }
}).pretty()
```

## ุงููููุงุช ุงููุนุฏูุฉ

- `backend/controllers/authController.js` - ุชุนููู expiresAt ุนูุฏ ุงูุชุณุฌูู
- `backend/controllers/orderController.js` - ุฅุถุงูุฉ ุงูููุงุท ุนูุฏ ุฃูู ุดุฑุงุก
- `backend/scripts/cleanupExpiredBonuses.js` - ุชูุธูู ุงูููุงุท ุงูููุชููุฉ
